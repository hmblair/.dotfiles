#!/usr/bin/env zsh

if [[ -x "$LOCAL_PREFIX/bin/oh-my-posh" ]] || command -v oh-my-posh &>/dev/null; then
    return 0 2>/dev/null || exit 0
fi

# Check dependencies
if ! command -v curl &>/dev/null; then
    echo "Error: curl is required but not installed"
    return 1 2>/dev/null || exit 1
fi

mkdir -p "$PREFIX/bin"

TMPDIR=$(mktemp -d)
trap "rm -rf '$TMPDIR'" EXIT

# Download installer to temp file first (safer than piping to bash)
curl -fsSL https://ohmyposh.dev/install.sh -o "$TMPDIR/install.sh" || return 1
bash "$TMPDIR/install.sh" -d "$PREFIX/bin" || return 1
