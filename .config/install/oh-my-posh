#!/usr/bin/env zsh

if [[ -x "$LOCAL_PREFIX/bin/oh-my-posh" ]] || command -v oh-my-posh &> /dev/null; then
    return 0 2>/dev/null || exit 0
fi

# Check dependencies
if ! command -v curl &>/dev/null; then
    echo "Error: curl is required but not installed"
    return 1 2>/dev/null || exit 1
fi

mkdir -p "$LOCAL_PREFIX/bin"

# Download installer to temp file first (safer than piping to bash)
INSTALLER="/tmp/oh-my-posh-install-$$.sh"
curl -fsSL https://ohmyposh.dev/install.sh -o "$INSTALLER" || { rm -f "$INSTALLER"; return 1; }
bash "$INSTALLER" -d "$LOCAL_PREFIX/bin" || { rm -f "$INSTALLER"; return 1; }
rm -f "$INSTALLER"
