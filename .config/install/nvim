#!/usr/bin/env zsh

if ! command -v nvim &> /dev/null; then
    pushd /tmp > /dev/null
    rm -rf neovim
    git clone --depth 1 https://github.com/neovim/neovim
    cd neovim

    export CFLAGS="-march=native -gdwarf-4"
    export CXXFLAGS="-march=native -gdwarf-4"

    JOBS=$(nproc 2>/dev/null || sysctl -n hw.ncpu 2>/dev/null || echo 1)
    make -j"$JOBS" CMAKE_BUILD_TYPE=RelWithDebInfo

    if sudo -n true 2>/dev/null; then
        sudo make install CMAKE_INSTALL_PREFIX="/usr/local"
    else
        make install CMAKE_INSTALL_PREFIX="$HOME/.local"
    fi

    popd > /dev/null
fi
