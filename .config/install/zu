#!/usr/bin/env zsh

# Check dependencies
if ! command -v git &>/dev/null; then
    echo "Error: git is required but not installed"
    return 1
fi

ZU_DIR="$LOCAL_PREFIX/share/zu"

if [[ ! -d "$ZU_DIR" ]]; then
    # Fresh install: show errors
    git clone https://github.com/hmblair/zu.git "$ZU_DIR" || return 1
    zsh "$ZU_DIR/configure" >/dev/null || return 1
else
    # Already installed: update in background, log errors but don't fail
    (
        cd "$ZU_DIR" && \
        git pull --rebase --quiet 2>&1 && \
        zsh ./configure 2>&1
    ) >> "${LOG_DIR:-$HOME/.local/log/install}/zu-update.log" 2>&1 &!
fi
